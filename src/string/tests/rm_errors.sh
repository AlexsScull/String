#!/bin/bash

# ========================================================
# Скрипт для очистки тестовых строк из исходного кода
#
# Назначение:
# Удаляет из файла все строки, содержащие маркер '// TEST_'
# 
# Особенности:
# - Создает временный файл для обработки
# - Сохраняет все строки, кроме содержащих указанный маркер
# - Заменяет оригинальный файл обработанной версией
# - Не создает резервную копию (используйте с осторожностью)
#
# Использование:
# ./rm_errors.sh <имя_файла>
# Например: ./rm_errors.sh test_sprintf.c

# ========================================================

# Проверяем, передан ли файл в аргументах
if [ $# -eq 0 ]; then
    echo "Использование: $0 <имя_файла>"
    exit 1
fi

file="$1"

# Проверяем существование файла
if [ ! -f "$file" ]; then
    echo "Ошибка: файл '$file' не существует"
    exit 1
fi

# Создаем временный файл
temp_file=$(mktemp)

# Удаляем строки, содержащие '// TEST_' и сохраняем во временный файл
grep -v '// TEST_' "$file" > "$temp_file"

# Перемещаем временный файл на место оригинального
mv "$temp_file" "$file"

echo "Удалены строки, содержащие '// TEST_' из файла '$file'"